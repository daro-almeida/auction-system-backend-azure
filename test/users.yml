config:
  target: "http://localhost:8080/rest"
  processor: "./users.js"
  phases:
  - name: "Warm up"
    duration: 5
    arrivalRate: 1
    rampTo: 5
  - name: "Load"
    duration: 5
    arrivalRate: 10


scenarios:
  - name: "Create user"
    weight: 2
    flow:
      - post:
          url: "/user"
          headers:
            Content-Type: application/json
            Accept: application/json
          beforeRequest: "inject_random_user"
          afterResponse: "on_user_create_complete"

  - name: "Delete User"
    weight: 2
    flow:
      - function: "pick_uploaded_user"
      - delete:
          url: "/user/{{ userId }}"
          ifTrue: "userId"

  - name: "Update User"
    weight: 2
    flow:
      - function: "pick_uploaded_user"
      - patch:
          url: "/user/{{ userId }}"
          headers:
            Content-Type: application/json
          ifTrue: "userId"